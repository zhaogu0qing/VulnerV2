# coding:utf8
"""
Created by zhaoguoqing on 18/11/4
"""
from bson import ObjectId
from flask import (
    Blueprint, flash, g, redirect, render_template, request, session, url_for, jsonify, abort
)
from .db import get_db

bp = Blueprint('vulner', __name__, url_prefix='/vulner')

@bp.route('/all/page/<int:page_num>', methods=('GET',))
def get_all(page_num=0):
    db = get_db()
    vulners = []
    for idx, v in enumerate(db['cnnvdVulnerability'].find().skip(page_num * 10).limit(10), 1):
        v['idx'] = idx
        v['_id'] = str(v['_id'])
        vulners.append(v)
    return render_template('vulner/showAll.html', vulners=vulners)

@bp.route('/detail/<string:vulner_id>', methods=('GET',))
def get_detail(vulner_id):
    db = get_db()
    vulner = db['cnnvdVulnerability'].find_one({'_id': ObjectId(vulner_id)})
    if not vulner:
        abort(404)
    #
    return render_template('vulner/showDetail.html', vulner=vulner)